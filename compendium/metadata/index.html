<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Daniel Nüst, Marc Schutzeichel, Markus Konkol">
  <link rel="canonical" href="https://o2r.info/api/compendium/metadata/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Compendium metadata - o2r web API</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../o2r.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Compendium metadata";
    var mkdocs_page_input_path = "compendium/metadata.md";
    var mkdocs_page_url = "/api/compendium/metadata/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> o2r web API</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Compendium management</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../overview/">Overview of the compendiuam life-cycle</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../upload/">API upload</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../public_share/">Public share submission</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../candidate/">Candidates</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../view/">View a compendium</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../delete/">Delete a compendium</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../download/">Download a compenium</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Compendium metadata</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#basics">Basics</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#metadata-formats">Metadata formats</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#metadata-validation">Metadata validation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#get-all-compendium-metadata">Get all compendium metadata</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#get-o2r-metadata">Get o2r metadata</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#url-parameters">URL parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#spatial-metadata">Spatial metadata</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#update-metadata">Update metadata</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#metadata-update-request">Metadata update request</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#url-parameters_1">URL parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#metadata-update-response">Metadata update response</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#metadata-update-error-responses">Metadata update error responses</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#other-metadata-properties">Other metadata properties</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../files/">Files in a compendium</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../job/">Compendium execution</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../shipment/">Shipments</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Extras</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../substitute/">Substitution</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../link/">Public links</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Search</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../search/">Finding compendia and jobs</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Users</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../user/user/">User management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user/levels/">User levels</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user/auth/">Authentication (for developers)</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">o2r web API</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Compendium management &raquo;</li>
        
      
    
    <li>Compendium metadata</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/o2r-project/api/tree/master/docs/compendium/metadata.md"> Edit on github.com/o2r-project/api</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="compendium-metadata">Compendium metadata<a class="headerlink" href="#compendium-metadata" title="Permanent link">&para;</a></h1>
<h2 id="basics">Basics<a class="headerlink" href="#basics" title="Permanent link">&para;</a></h2>
<p>Metadata in a compendium is stored in a directory <code>.erc</code>. This directory contains the normative metadata documents using a file naming scheme <code>&lt;PREFIX&gt;_&lt;MODEL&gt;_&lt;VERSION&gt;.&lt;FORMAT&gt;</code> filled via each metadata mapping file found in the broker tool of the o2r metadata tool suite, the default prefix is <code>metadata</code>, e.g. <code>metadata_o2r_1.json</code>, <code>metadata_zenodo_1.json</code>, or <code>metadata_datacite_41.xml</code>. The filename of the extracted raw metadata has no versioning and is constantly found as <code>metadata_raw.json</code>.</p>
<p>A copy of the files in this directory is kept in database for easier access, so every compendium returned by the API can contain different sub-properties in the metadata property.
<em>This API always returns the database copy of the metadata elements.</em>
You can download the respective files to access the normative metadata documents.</p>
<h2 id="metadata-formats">Metadata formats<a class="headerlink" href="#metadata-formats" title="Permanent link">&para;</a></h2>
<p>The files are available on demand, but metadata variants are created after each metadata update.</p>
<p>The sub-properties of the <code>metadata</code> and their content are</p>
<ul>
<li><code>raw</code> contains raw metadata extracted automatically</li>
<li><code>o2r</code> holds the <strong>main information for display</strong> and is modelled according the the o2r metadata model. This metadata is reviewed by the user and the basis for translating to other metadata formats and also for <a href="../../search/">search</a>.</li>
<li><code>zenodo</code> holds <a href="https://zenodo.org/">Zenodo</a> metadata for shipments made to Zenodo and is brokered from <code>o2r</code> metadata</li>
<li><code>zenodo_sandbox</code> holds <a href="https://zenodo.org/">Zenodo</a> metadata for shipments made to Zenodo Sandbox, i.e. a clone of <code>zenodo</code> metadata</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The information in each sub-property are subject to independent workflows and may differ from one another.
The term <strong>brokering</strong> is used for translation from one metadata format into another.</p>
</div>
<h2 id="metadata-validation">Metadata validation<a class="headerlink" href="#metadata-validation" title="Permanent link">&para;</a></h2>
<p>Only valid metadata can be saved to a compendium.
The <code>o2r</code> metadata element is validated against a <a href="http://json-schema.org/">JSON Schema</a> using the <code>validate</code> tool of <a href="https://github.com/o2r-project/o2r-meta"><code>o2r-meta</code></a>.
The schema file is included in the <code>o2r-meta</code> repository: <a href="https://raw.githubusercontent.com/o2r-project/o2r-meta/master/schema/json/o2r-meta-schema.json">https://raw.githubusercontent.com/o2r-project/o2r-meta/master/schema/json/o2r-meta-schema.json</a>.</p>
<h2 id="get-all-compendium-metadata">Get all compendium metadata<a class="headerlink" href="#get-all-compendium-metadata" title="Permanent link">&para;</a></h2>
<p><code>curl https://…/api/v1/$ID</code></p>
<p><code>GET /api/v1/compendium/:id</code></p>
<p>Abbreviated example response:</p>
<pre><code class="json">200 OK

{
  &quot;id&quot;:&quot;12345&quot;,
  &quot;metadata&quot;: {
    &quot;raw&quot;: {
      &quot;title&quot;: &quot;Programming with Data. Springer, New York, 1998. ISBN 978-0-387-98503-9.&quot;,
      &quot;author&quot;: &quot;John M. Chambers&quot;,
      …
    },
    &quot;o2r&quot;: {
      &quot;title&quot;: &quot;Programming with Data&quot;,
      &quot;creators&quot;: [
          {
              &quot;name&quot;: &quot;John M. Chambers&quot;
          }
      ],
      &quot;publication_date&quot;: 1998,
      …
    },
    &quot;zenodo&quot;: {
      …
    }
  },
  &quot;created&quot;: …,
  &quot;files&quot;: …
}
</code></pre>

<h2 id="get-o2r-metadata">Get o2r metadata<a class="headerlink" href="#get-o2r-metadata" title="Permanent link">&para;</a></h2>
<p>The following endpoint allows to access <em>only</em> the normative o2r-metadata element:</p>
<p><code>curl https://…/api/v1/$ID/metadata</code></p>
<p><code>GET /api/v1/compendium/:id/metadata</code></p>
<pre><code class="json">200 OK

{
  &quot;id&quot;:&quot;compendium_id&quot;,
  &quot;metadata&quot;: {
    &quot;o2r&quot;: {
      …
    }
  }
}
</code></pre>

<h3 id="url-parameters">URL parameters<a class="headerlink" href="#url-parameters" title="Permanent link">&para;</a></h3>
<ul>
<li><code>:id</code> - compendium id</li>
</ul>
<h3 id="spatial-metadata">Spatial metadata<a class="headerlink" href="#spatial-metadata" title="Permanent link">&para;</a></h3>
<p>For discovery purposes, the metadata includes extracted <a href="http://geojson.org/">GeoJSON</a> bounding boxes based on data files in a workspace.</p>
<p>Currently supported spatial data sources:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Shapefile">shapefiles</a></li>
</ul>
<p>The following structure is made available per file:</p>
<pre><code class="json">    &quot;spatial&quot;: {
        &quot;files&quot;: [
            {
                &quot;geojson&quot;: {
                    &quot;bbox&quot;: [
                        -2.362060546875,
                        52.0862573323384,
                        -1.285400390625,
                        52.649729197309426
                    ],
                    &quot;geometry&quot;: {
                        &quot;coordinates&quot;: [
                            [
                                [
                                    -2.362060546875,
                                    52.0862573323384
                                ],
                                [
                                    -1.285400390625,
                                    52.649729197309426
                                ]
                            ]
                        ],
                        &quot;type&quot;: &quot;Polygon&quot;
                    },
                    &quot;type&quot;: &quot;Feature&quot;
                },
                &quot;source_file&quot;: &quot;path/to/file1.geojson&quot;
            },
            {
                &quot;geojson&quot;: {
                    &quot;bbox&quot;: [
                        7.595369517803192,
                        51.96245837645124,
                        7.62162297964096,
                        51.96966694957956
                    ],
                    &quot;geometry&quot;: {
                        &quot;coordinates&quot;: [
                            [
                                [
                                    7.595369517803192,
                                    51.96245837645124
                                ],
                                [
                                    7.62162297964096,
                                    51.96966694957956
                                ]
                            ]
                        ],
                        &quot;type&quot;: &quot;Polygon&quot;
                    },
                    &quot;type&quot;: &quot;Feature&quot;
                },
                &quot;source_file&quot;: &quot;path/to/file2.shp&quot;
            }
        ],
        &quot;union&quot;: {
            &quot;geojson&quot;: {
                &quot;bbox&quot;: [
                    -2.362060546875,
                    51.96245837645124,
                    7.62162297964096,
                    51.96245837645124
                ],
                &quot;geometry&quot;: {
                    &quot;coordinates&quot;: [
                        [
                            -2.362060546875,
                            51.96245837645124
                        ],
                        [
                            7.62162297964096,
                            51.96245837645124
                        ],
                        [
                            7.62162297964096,
                            52.649729197309426
                        ],
                        [
                            -2.362060546875,
                            52.649729197309426
                        ]
                    ],
                    &quot;type&quot;: &quot;Polygon&quot;
                },
                &quot;type&quot;: &quot;Feature&quot;
            }
        }
    }
</code></pre>

<p>The <code>spatial</code> key has a <code>union</code> bounding box, that wraps all extracted bounding boxes.</p>
<h2 id="update-metadata">Update metadata<a class="headerlink" href="#update-metadata" title="Permanent link">&para;</a></h2>
<p>The following endpoint can be used to update the <code>o2r</code> metadata elements.
All other metadata sub-properties are only updated by the service itself, i.e. brokered metadata.
After creation the metadata is persisted to both files and database, so updating the metadata via this endpoint allows to trigger a brokering process and to retrieve different metadata formats either via this metadata API or via downloading the respective file using the <a href="../download/">download endpoint</a>.</p>
<div class="admonition note">
<p class="admonition-title">Metadata update rights</p>
<p>Only authors of a compendium or users with the required <a href="../../user/levels/">user level</a> can update a compendium's metadata.</p>
</div>
<h3 id="metadata-update-request">Metadata update request<a class="headerlink" href="#metadata-update-request" title="Permanent link">&para;</a></h3>
<pre><code class="bash">curl -H 'Content-Type: application/json' \
  -X PUT \
  --cookie &quot;connect.sid=&lt;code string here&gt;&quot; \
  -d '{ &quot;o2r&quot;: { &quot;title&quot;: &quot;Blue Book&quot; } }' \
  /api/v1/compendium/:id/metadata
</code></pre>

<p>The request <em>overwrites</em> the existing metadata properties, so the <em>full</em> o2r metadata must be put with a JSON object called <code>o2r</code> at the root, even if only specific fields are changed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This endpoint allows only to update the <code>metadata.o2r</code> elements. All other properties of </p>
</div>
<h3 id="url-parameters_1">URL parameters<a class="headerlink" href="#url-parameters_1" title="Permanent link">&para;</a></h3>
<ul>
<li><code>:id</code> - compendium id</li>
</ul>
<h3 id="metadata-update-response">Metadata update response<a class="headerlink" href="#metadata-update-response" title="Permanent link">&para;</a></h3>
<p>The response contains an excerpt of a compendium with only the o2r metadata property.</p>
<pre><code class="json">200 OK

{
  &quot;id&quot;:&quot;compendium_id&quot;,
  &quot;metadata&quot;: {
    &quot;o2r&quot;: {
      &quot;title&quot;: &quot;Blue Book&quot;
    }
  }
}
</code></pre>

<h3 id="metadata-update-error-responses">Metadata update error responses<a class="headerlink" href="#metadata-update-error-responses" title="Permanent link">&para;</a></h3>
<pre><code class="json">401 Unauthorized

{&quot;error&quot;:&quot;not authorized&quot;}
</code></pre>

<pre><code class="json">400 Incomplete metadata (description property missing)

{
    &quot;error&quot;:&quot;Error updating metadata file, see log for details&quot;,
    &quot;log&quot;: &quot;[o2rmeta] 20180302.085940 received arguments: {'debug': True, 'tool': 'validate', 'schema': 'schema/json/o2r-meta-schema.json', 'candidate': '/tmp/o2r/compendium/1cAIr/data/.erc/metadata_o2r_1.json'}
    [o2rmeta] 20180302.085940 launching validator
    [o2rmeta] 20180302.085940 checking metadata_o2r_1.json against o2r-meta-schema.json
    [o2rmeta] 20180302.085940 !invalid: None is not of type 'string'

    Failed validating 'type' in schema['properties']['description']:
        {'type': 'string'}

        On instance['description']:
            None&quot;
}
</code></pre>

<pre><code class="json">400 Bad Request

&quot;SyntaxError [...]&quot;
</code></pre>

<pre><code class="json">422 Unprocessable Entity

{&quot;error&quot;:&quot;JSON with root element 'o2r' required&quot;}
</code></pre>

<h2 id="other-metadata-properties">Other metadata properties<a class="headerlink" href="#other-metadata-properties" title="Permanent link">&para;</a></h2>
<p>Besides the <code>metadata</code> element, a compendium persists some additional properties to reduce computation on the server, and to allows client applications to improve the user experience.</p>
<ul>
<li><code>bag</code> - a boolean showing if the uploaded artefact was detected as a BagIt bag (detection file: <code>bagit.txt</code>)</li>
<li><code>compendium</code> - a boolean showing if the uploaded artefact was detected as a compendium (detection file: <code>erc.yml</code>)</li>
</ul>
<p><strong>Example:</strong></p>
<p>(Properties <code>metadata</code> and <code>files</code> not shown for brevity.)</p>
<pre><code class="json">{

    &quot;id&quot;: &quot;U9IZ7&quot;,
    &quot;metadata&quot;: {},
    &quot;created&quot;: &quot;2017-01-01T00:00:42.000Z&quot;,
    &quot;user&quot;: &quot;0000-0002-1825-0097&quot;,
    &quot;bag&quot;: false,
    &quot;compendium&quot;: false,
    &quot;files&quot;: {}
}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../files/" class="btn btn-neutral float-right" title="Files in a compendium">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../download/" class="btn btn-neutral" title="Download a compenium"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Licensed under Creative Commons CC0 1.0 Universal License.</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../download/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../files/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
