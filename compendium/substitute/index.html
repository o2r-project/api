<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Daniel NÃ¼st, Marc Schutzeichel, Markus Konkol">
  <link rel="canonical" href="https://o2r.info/api/compendium/substitute/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Substitution - o2r web API</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../o2r.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Substitution";
    var mkdocs_page_input_path = "compendium/substitute.md";
    var mkdocs_page_url = "/api/compendium/substitute/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> o2r web API</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Compendium management</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../overview/">Overview of the compendium life-cycle</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../upload/">API upload</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../public_share/">Public share submission</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../candidate/">Candidates</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../view/">View a compendium</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../delete/">Delete a compendium</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../download/">Download a compenium</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../metadata/">Compendium metadata</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../files/">Files in a compendium</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../job/">Compendium execution</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../shipment/">Shipments</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Extras</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Substitution</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#create-substitution">Create substitution</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#request">Request</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#request-body-properties">Request body properties</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#response">Response</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#error-responses">Error responses</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#view-substituted-compendium">View substituted Compendium</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#request_1">Request</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#response_1">Response</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#response-additional-metadata">Response additional metadata</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#list-substituted-compendia">List substituted Compendia</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#request_2">Request</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#response_2">Response</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#filter-results-with-following-parameters">Filter results with following parameters:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#error-responses_1">Error responses</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#url-parameters-for-substituted-compendium-lists">URL parameters for substituted compendium lists</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../link/">Public links</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Users</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../user/user/">User management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user/levels/">User levels</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../user/auth/">Authentication (for developers)</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">o2r web API</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Extras &raquo;</li>
        
      
    
    <li>Substitution</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/o2r-project/api/tree/master/docs/compendium/substitute.md"> Edit on github.com/o2r-project/api</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="substitution">Substitution<a class="headerlink" href="#substitution" title="Permanent link">&para;</a></h1>
<p>Substitution is the combination of an base compendium, "base" for short, and an overlay compendium, or "overlay".
A user can choose files from the overlay to replace files of the base, or upload new files.
Additionally the user can choose, if the metadata of the base ERC will be adopted for substitution (<code>keepBase</code>) or there will be a new extraction of the metadata for the substituted ERC.
This new extraction is divided into two choices.
The user can let the new extracted metadata be merged into the existing metadata of the base ERC (<code>extractAndMerge</code> - <strong>not implemented</strong>) or just save the extracted metadata (<code>extract</code> - <strong>not implemented</strong>).</p>
<h2 id="create-substitution">Create substitution<a class="headerlink" href="#create-substitution" title="Permanent link">&para;</a></h2>
<p><code>Create substitution</code> produces a new compendium with its own files in the storage and metadata in the database.
A substitution can be created with an HTTP <code>POST</code> request using <code>multipart/form-data</code> and content-type <code>JSON</code>.
Required content of the request are the identifiers of the base and overlay compendia and at least one pair of <em>substitution files</em>, consisting of a base file and an overlay file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A substitution process removes potentially existing packaging information, i.e. if the base compendium was a BagIt bag, the substitution will only contain the payload directory contents (<code>/data</code> directory).</p>
<p>The overlay file is stripped of all paths and is copied directly into the substitution's root directory.</p>
</div>
<h3 id="request">Request<a class="headerlink" href="#request" title="Permanent link">&para;</a></h3>
<p><code>POST /api/v1/substitution</code></p>
<p>Request body for a new substitution:</p>
<pre><code class="language-json">{
  &quot;base&quot;: &quot;G92NL&quot;,
  &quot;overlay&quot;: &quot;9fCTR&quot;,
  &quot;substitutionFiles&quot;: [
    {
      &quot;base&quot;: &quot;climate-timeseries.csv&quot;,
      &quot;overlay&quot;: &quot;mytimeseries_data.csv&quot;
    }
  ],
  &quot;metadataHandling&quot;: &quot;keepBase&quot;
}
</code></pre>
<h3 id="request-body-properties">Request body properties<a class="headerlink" href="#request-body-properties" title="Permanent link">&para;</a></h3>
<ul>
<li><code>base</code> - id of the base compendium</li>
<li><code>overlay</code> - id of the overlay compendium</li>
<li><code>substitutionFiles</code> - array of file substitutions specified by <code>base</code> and <code>overlay</code></li>
<li><code>base</code> - name of the file from the base compendium</li>
<li><code>overlay</code> - name of the overlay compendium that is exchanged for the original file</li>
<li><code>metadataHandling</code> - property to specify, if the metadata of the base ERC will be adopted (<code>keepBase</code> = <strong>keep metadata</strong> of base ERC) or there will be a new extraction of metadata, that will be merged into the metadata of the base ERC (<code>extractAndMerge</code> = <strong>extract and merge metadata</strong> for new ERC) or that will not be merged (<code>extract</code> = <strong>extract metadata</strong> of new ERC)</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Required user level</p>
<p>The user creating a new substitution must have the required <a href="../../user/levels/">user level</a>.</p>
</div>
<h3 id="response">Response<a class="headerlink" href="#response" title="Permanent link">&para;</a></h3>
<pre><code class="language-json">201 CREATED

{
  &quot;id&quot;: &quot;oMMFn&quot;
}
</code></pre>
<h3 id="error-responses">Error responses<a class="headerlink" href="#error-responses" title="Permanent link">&para;</a></h3>
<pre><code class="language-json">401 Unauthorized

{&quot;error&quot;:&quot;not authenticated&quot;}
</code></pre>
<pre><code class="language-json">401 Unauthorized

{&quot;error&quot;:&quot;not allowed&quot;}
</code></pre>
<pre><code class="language-json">404 Not Found

{&quot;error&quot;:&quot;base compendium not found&quot;}
</code></pre>
<pre><code class="language-json">404 Not Found

{&quot;error&quot;:&quot;overlay compendium not found&quot;}
</code></pre>
<h2 id="view-substituted-compendium">View substituted Compendium<a class="headerlink" href="#view-substituted-compendium" title="Permanent link">&para;</a></h2>
<h3 id="request_1">Request<a class="headerlink" href="#request_1" title="Permanent link">&para;</a></h3>
<p><code>curl https://.../api/v1/compendium/$ID</code></p>
<p><code>GET /api/v1/compendium/:id</code></p>
<p>This request is handled as regular GET request of a compendium (see <a href="/api/compendium/view/#view-single-compendium">View single compendium</a>).</p>
<h3 id="response_1">Response<a class="headerlink" href="#response_1" title="Permanent link">&para;</a></h3>
<p>A substituted compendium is be saved as a usual compendium, but with additional metadata specifying this as a substituted compendium and giving information about the substitution.</p>
<p>Example 01 - in case there are no conflicts between filenames of any base file and overlay file :</p>
<pre><code class="language-json">200 OK

{
  &quot;id&quot;: &quot;oMMFn&quot;,
  ...
  &quot;metadata&quot;: {
      ...
      &quot;substitution&quot;: {
          &quot;base&quot;: &quot;G92NL&quot;,
          &quot;overlay&quot;: &quot;9fCTR&quot;,
          &quot;substitutionFiles&quot;: [
            {
              &quot;base&quot;: &quot;climate-timeseries.csv&quot;,
              &quot;overlay&quot;: &quot;mytimeseries_data.csv&quot;,
              &quot;filename&quot;: &quot;climate-timeseries.csv&quot;
            }
          ],
          &quot;metadataHandling&quot;: &quot;keepBase&quot;
      },
      ...
  },
  &quot;substituted&quot;: true,
  ...
}
</code></pre>
<p>Example 02 - in case the overlay file has the same filename as one of the existing base files and is in a sub-directory in the overlay compendium:</p>
<pre><code class="language-json">200 OK

{
  &quot;id&quot;: &quot;oMMFn&quot;,
  ...
  &quot;metadata&quot;: {
      ...
      &quot;substitution&quot;: {
          &quot;base&quot;: &quot;G92NL&quot;,
          &quot;overlay&quot;: &quot;9fCTR&quot;,
          &quot;substitutionFiles&quot;: [
            {
              &quot;base&quot;: &quot;climate-timeseries.csv&quot;,
              &quot;overlay&quot;: &quot;dataFiles/input.csv&quot;,
              &quot;filename&quot;: &quot;overlay_input.csv&quot;
            }
          ],
          &quot;metadataHandling&quot;: &quot;keepBase&quot;
      },
      ...
  },
  &quot;substituted&quot;: true,
  ...
}
</code></pre>
<h3 id="response-additional-metadata">Response additional metadata<a class="headerlink" href="#response-additional-metadata" title="Permanent link">&para;</a></h3>
<ul>
<li><code>metadata.substitution</code> - object, specifying information about the substitution<ul>
<li><code>base</code> - id of the base compendium</li>
<li><code>overlay</code> - id of the overlay compendium</li>
<li><code>substitutionFiles</code> - array of file substitutions specified by <code>base</code> and <code>overlay</code><ul>
<li><code>base</code> - name of the file from the base ERC</li>
<li><code>overlay</code> - name of the file from the overlay ERC</li>
<li><code>filename</code> - as seen in the examples above, <code>filename</code> will be created.
If there is a conflict with any basefilename and an overlayfilename, the overlayfilename will get an additional "<strong>overlay_</strong>" prepended (see Example 02). <em>(optional add)</em></li>
</ul>
</li>
<li><code>metadataHandling</code> - property to specify, if the metadata of the base ERC will be adopted (<code>keepBase</code> = <strong>keep metadata</strong> of base ERC) or there will be a new extraction of metadata, that will be merged into the metadata of the base ERC (<code>extractAndMerge</code> = <strong>extract and merge metadata</strong> for new ERC) or that will not be merged (<code>extract</code> = <strong>extract metadata</strong> of new ERC)</li>
</ul>
</li>
<li><code>substituted</code> - will be set <code>true</code></li>
</ul>
<h2 id="list-substituted-compendia">List substituted Compendia<a class="headerlink" href="#list-substituted-compendia" title="Permanent link">&para;</a></h2>
<h3 id="request_2">Request<a class="headerlink" href="#request_2" title="Permanent link">&para;</a></h3>
<p><code>curl https://.../api/v1/substitution</code></p>
<p><code>GET /api/v1/substitution</code></p>
<h3 id="response_2">Response<a class="headerlink" href="#response_2" title="Permanent link">&para;</a></h3>
<p>The result is a list of compendia ids which were created by a substitution process.</p>
<pre><code class="language-json">200 OK

{
  &quot;results&quot;: [
    &quot;oMMFn&quot;,
    &quot;asdi5&quot;,
    &quot;nb2sg&quot;,
    â¦
  ]
}
</code></pre>
<p>If there are no substitutions yet, the returned list is empty.</p>
<pre><code class="language-json">200 OK
{
  &quot;results&quot;: [ ]
}
</code></pre>
<h3 id="filter-results-with-following-parameters">Filter results with following parameters:<a class="headerlink" href="#filter-results-with-following-parameters" title="Permanent link">&para;</a></h3>
<p><code>curl https://.../api/v1/substitution?base=$BASE_ID&amp;overlay=$OVERLAY_ID</code></p>
<p><code>GET /api/v1/substitution?base=base_id&amp;overlay=overlay_id</code></p>
<ul>
<li>Filter by <code>base</code>:</li>
</ul>
<p><code>curl https://.../api/v1/substitution?base=jfL3w</code></p>
<p><code>GET /api/v1/substitution?base=jfL3w</code></p>
<p>Result is a list of substituted compendia based on the given base compendium:</p>
<pre><code class="language-json">200 OK

{
  &quot;results&quot;: [
    &quot;wGmFn&quot;,
    â¦
  ]
}
</code></pre>
<ul>
<li>Filter by <code>overlay</code>:</li>
</ul>
<p><code>curl https://.../api/v1/substitution?overlay=as4Kj</code></p>
<p><code>GET /api/v1/substitution?overlay=as4Kj</code></p>
<p>Result is a list of substituted compendia based on the given overlay compendium:</p>
<pre><code class="language-json">200 OK

{
  &quot;results&quot;: [
    &quot;9pQ34&quot;,
    &quot;1Tnd3&quot;,
    â¦
  ]
}
</code></pre>
<ul>
<li>Filter by <code>base</code> and <code>overlay</code>:</li>
</ul>
<p><code>curl https://.../api/v1/substitution?base=lO3Td&amp;overlay=as4Kj</code></p>
<p><code>GET /api/v1/substitution?base=lO3Td&amp;overlay=as4Kj</code></p>
<p>Result is a list of substituted compendia based on the given base <em>and</em> overlay compendium:</p>
<pre><code class="language-json">200 OK

{
  &quot;results&quot;: [
    &quot;9pQ34&quot;,
    â¦
  ]
}
</code></pre>
<h3 id="error-responses_1">Error responses<a class="headerlink" href="#error-responses_1" title="Permanent link">&para;</a></h3>
<pre><code class="language-json">401 Unauthorized

{&quot;error&quot;:&quot;not authenticated&quot;}
</code></pre>
<pre><code class="language-json">401 Unauthorized

{&quot;error&quot;:&quot;not allowed&quot;}
</code></pre>
<pre><code class="language-json">404 Not Found

{&quot;error&quot;:&quot;base compendium not found&quot;}
</code></pre>
<pre><code class="language-json">404 Not Found

{&quot;error&quot;:&quot;overlay compendium not found&quot;}
</code></pre>
<pre><code class="language-json">400 Not Found

{&quot;error&quot;:&quot;base file is undefined&quot;}
</code></pre>
<pre><code class="language-json">400 Not Found

{&quot;error&quot;:&quot;overlay file is undefined&quot;}
</code></pre>
<h3 id="url-parameters-for-substituted-compendium-lists">URL parameters for substituted compendium lists<a class="headerlink" href="#url-parameters-for-substituted-compendium-lists" title="Permanent link">&para;</a></h3>
<ul>
<li><code>:base</code> - id of the base compendium that the results should be related to</li>
<li><code>:overlay</code> - id of the overlay compendium that the results should be related to</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../link/" class="btn btn-neutral float-right" title="Public links">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../shipment/" class="btn btn-neutral" title="Shipments"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Licensed under Creative Commons CC0 1.0 Universal License.</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../shipment/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../link/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
